%!PS-Adobe-2.0
%%Creator: dvips(k) 5.96.1 Copyright 2007 Radical Eye Software
%%Title: fs-semantics.dvi
%%CreationDate: Thu Feb  4 12:40:14 2010
%%Pages: 10
%%PageOrder: Ascend
%%BoundingBox: 0 0 612 792
%%DocumentFonts: Times-Roman Times-Bold Times-Italic CMSY10 Courier-Bold
%%DocumentPaperSizes: Letter
%%EndComments
%DVIPSWebPage: (www.radicaleye.com)
%DVIPSCommandLine: dvips -t letter fs-semantics.dvi -o fs-semantics.ps
%DVIPSParameters: dpi=600
%DVIPSSource:  TeX output 2010.02.04:1240
%%BeginProcSet: tex.pro 0 0
%!
/TeXDict 300 dict def TeXDict begin/N{def}def/B{bind def}N/S{exch}N/X{S
N}B/A{dup}B/TR{translate}N/isls false N/vsize 11 72 mul N/hsize 8.5 72
mul N/landplus90{false}def/@rigin{isls{[0 landplus90{1 -1}{-1 1}ifelse 0
0 0]concat}if 72 Resolution div 72 VResolution div neg scale isls{
landplus90{VResolution 72 div vsize mul 0 exch}{Resolution -72 div hsize
mul 0}ifelse TR}if Resolution VResolution vsize -72 div 1 add mul TR[
matrix currentmatrix{A A round sub abs 0.00001 lt{round}if}forall round
exch round exch]setmatrix}N/@landscape{/isls true N}B/@manualfeed{
statusdict/manualfeed true put}B/@copies{/#copies X}B/FMat[1 0 0 -1 0 0]
N/FBB[0 0 0 0]N/nn 0 N/IEn 0 N/ctr 0 N/df-tail{/nn 8 dict N nn begin
/FontType 3 N/FontMatrix fntrx N/FontBBox FBB N string/base X array
/BitMaps X/BuildChar{CharBuilder}N/Encoding IEn N end A{/foo setfont}2
array copy cvx N load 0 nn put/ctr 0 N[}B/sf 0 N/df{/sf 1 N/fntrx FMat N
df-tail}B/dfs{div/sf X/fntrx[sf 0 0 sf neg 0 0]N df-tail}B/E{pop nn A
definefont setfont}B/Cw{Cd A length 5 sub get}B/Ch{Cd A length 4 sub get
}B/Cx{128 Cd A length 3 sub get sub}B/Cy{Cd A length 2 sub get 127 sub}
B/Cdx{Cd A length 1 sub get}B/Ci{Cd A type/stringtype ne{ctr get/ctr ctr
1 add N}if}B/CharBuilder{save 3 1 roll S A/base get 2 index get S
/BitMaps get S get/Cd X pop/ctr 0 N Cdx 0 Cx Cy Ch sub Cx Cw add Cy
setcachedevice Cw Ch true[1 0 0 -1 -.1 Cx sub Cy .1 sub]{Ci}imagemask
restore}B/D{/cc X A type/stringtype ne{]}if nn/base get cc ctr put nn
/BitMaps get S ctr S sf 1 ne{A A length 1 sub A 2 index S get sf div put
}if put/ctr ctr 1 add N}B/I{cc 1 add D}B/bop{userdict/bop-hook known{
bop-hook}if/SI save N @rigin 0 0 moveto/V matrix currentmatrix A 1 get A
mul exch 0 get A mul add .99 lt{/QV}{/RV}ifelse load def pop pop}N/eop{
SI restore userdict/eop-hook known{eop-hook}if showpage}N/@start{
userdict/start-hook known{start-hook}if pop/VResolution X/Resolution X
1000 div/DVImag X/IEn 256 array N 2 string 0 1 255{IEn S A 360 add 36 4
index cvrs cvn put}for pop 65781.76 div/vsize X 65781.76 div/hsize X}N
/p{show}N/RMat[1 0 0 -1 0 0]N/BDot 260 string N/Rx 0 N/Ry 0 N/V{}B/RV/v{
/Ry X/Rx X V}B statusdict begin/product where{pop false[(Display)(NeXT)
(LaserWriter 16/600)]{A length product length le{A length product exch 0
exch getinterval eq{pop true exit}if}{pop}ifelse}forall}{false}ifelse
end{{gsave TR -.1 .1 TR 1 1 scale Rx Ry false RMat{BDot}imagemask
grestore}}{{gsave TR -.1 .1 TR Rx Ry scale 1 1 false RMat{BDot}
imagemask grestore}}ifelse B/QV{gsave newpath transform round exch round
exch itransform moveto Rx 0 rlineto 0 Ry neg rlineto Rx neg 0 rlineto
fill grestore}B/a{moveto}B/delta 0 N/tail{A/delta X 0 rmoveto}B/M{S p
delta add tail}B/b{S p tail}B/c{-4 M}B/d{-3 M}B/e{-2 M}B/f{-1 M}B/g{0 M}
B/h{1 M}B/i{2 M}B/j{3 M}B/k{4 M}B/w{0 rmoveto}B/l{p -4 w}B/m{p -3 w}B/n{
p -2 w}B/o{p -1 w}B/q{p 1 w}B/r{p 2 w}B/s{p 3 w}B/t{p 4 w}B/x{0 S
rmoveto}B/y{3 2 roll p a}B/bos{/SS save N}B/eos{SS restore}B end

%%EndProcSet
%%BeginProcSet: 8r.enc 0 0
% File 8r.enc  TeX Base 1 Encoding  Revision 2.0  2002-10-30
%
% @@psencodingfile@{
%   author    = "S. Rahtz, P. MacKay, Alan Jeffrey, B. Horn, K. Berry,
%                W. Schmidt, P. Lehman",
%   version   = "2.0",
%   date      = "27nov06",
%   filename  = "8r.enc",
%   email     = "tex-fonts@@tug.org",
%   docstring = "This is the encoding vector for Type1 and TrueType
%                fonts to be used with TeX.  This file is part of the
%                PSNFSS bundle, version 9"
% @}
% 
% The idea is to have all the characters normally included in Type 1 fonts
% available for typesetting. This is effectively the characters in Adobe
% Standard encoding, ISO Latin 1, Windows ANSI including the euro symbol,
% MacRoman, and some extra characters from Lucida.
% 
% Character code assignments were made as follows:
% 
% (1) the Windows ANSI characters are almost all in their Windows ANSI
% positions, because some Windows users cannot easily reencode the
% fonts, and it makes no difference on other systems. The only Windows
% ANSI characters not available are those that make no sense for
% typesetting -- rubout (127 decimal), nobreakspace (160), softhyphen
% (173). quotesingle and grave are moved just because it's such an
% irritation not having them in TeX positions.
% 
% (2) Remaining characters are assigned arbitrarily to the lower part
% of the range, avoiding 0, 10 and 13 in case we meet dumb software.
% 
% (3) Y&Y Lucida Bright includes some extra text characters; in the
% hopes that other PostScript fonts, perhaps created for public
% consumption, will include them, they are included starting at 0x12.
% These are /dotlessj /ff /ffi /ffl.
% 
% (4) hyphen appears twice for compatibility with both ASCII and Windows.
%
% (5) /Euro was assigned to 128, as in Windows ANSI
%
% (6) Missing characters from MacRoman encoding incorporated as follows:
%
%     PostScript      MacRoman        TeXBase1
%     --------------  --------------  --------------
%     /notequal       173             0x16
%     /infinity       176             0x17
%     /lessequal      178             0x18
%     /greaterequal   179             0x19
%     /partialdiff    182             0x1A
%     /summation      183             0x1B
%     /product        184             0x1C
%     /pi             185             0x1D
%     /integral       186             0x81
%     /Omega          189             0x8D
%     /radical        195             0x8E
%     /approxequal    197             0x8F
%     /Delta          198             0x9D
%     /lozenge        215             0x9E
%
/TeXBase1Encoding [
% 0x00
 /.notdef /dotaccent /fi /fl
 /fraction /hungarumlaut /Lslash /lslash
 /ogonek /ring /.notdef /breve
 /minus /.notdef /Zcaron /zcaron
% 0x10
 /caron /dotlessi /dotlessj /ff
 /ffi /ffl /notequal /infinity
 /lessequal /greaterequal /partialdiff /summation
 /product /pi /grave /quotesingle
% 0x20
 /space /exclam /quotedbl /numbersign
 /dollar /percent /ampersand /quoteright
 /parenleft /parenright /asterisk /plus
 /comma /hyphen /period /slash
% 0x30
 /zero /one /two /three
 /four /five /six /seven
 /eight /nine /colon /semicolon
 /less /equal /greater /question
% 0x40
 /at /A /B /C
 /D /E /F /G
 /H /I /J /K
 /L /M /N /O
% 0x50
 /P /Q /R /S
 /T /U /V /W
 /X /Y /Z /bracketleft
 /backslash /bracketright /asciicircum /underscore
% 0x60
 /quoteleft /a /b /c
 /d /e /f /g
 /h /i /j /k
 /l /m /n /o
% 0x70
 /p /q /r /s
 /t /u /v /w
 /x /y /z /braceleft
 /bar /braceright /asciitilde /.notdef
% 0x80
 /Euro /integral /quotesinglbase /florin
 /quotedblbase /ellipsis /dagger /daggerdbl
 /circumflex /perthousand /Scaron /guilsinglleft
 /OE /Omega /radical /approxequal
% 0x90
 /.notdef /.notdef /.notdef /quotedblleft
 /quotedblright /bullet /endash /emdash
 /tilde /trademark /scaron /guilsinglright
 /oe /Delta /lozenge /Ydieresis
% 0xA0
 /.notdef /exclamdown /cent /sterling
 /currency /yen /brokenbar /section
 /dieresis /copyright /ordfeminine /guillemotleft
 /logicalnot /hyphen /registered /macron
% 0xB0
 /degree /plusminus /twosuperior /threesuperior
 /acute /mu /paragraph /periodcentered
 /cedilla /onesuperior /ordmasculine /guillemotright
 /onequarter /onehalf /threequarters /questiondown
% 0xC0
 /Agrave /Aacute /Acircumflex /Atilde
 /Adieresis /Aring /AE /Ccedilla
 /Egrave /Eacute /Ecircumflex /Edieresis
 /Igrave /Iacute /Icircumflex /Idieresis
% 0xD0
 /Eth /Ntilde /Ograve /Oacute
 /Ocircumflex /Otilde /Odieresis /multiply
 /Oslash /Ugrave /Uacute /Ucircumflex
 /Udieresis /Yacute /Thorn /germandbls
% 0xE0
 /agrave /aacute /acircumflex /atilde
 /adieresis /aring /ae /ccedilla
 /egrave /eacute /ecircumflex /edieresis
 /igrave /iacute /icircumflex /idieresis
% 0xF0
 /eth /ntilde /ograve /oacute
 /ocircumflex /otilde /odieresis /divide
 /oslash /ugrave /uacute /ucircumflex
 /udieresis /yacute /thorn /ydieresis
] def


%%EndProcSet
%%BeginProcSet: texps.pro 0 0
%!
TeXDict begin/rf{findfont dup length 1 add dict begin{1 index/FID ne 2
index/UniqueID ne and{def}{pop pop}ifelse}forall[1 index 0 6 -1 roll
exec 0 exch 5 -1 roll VResolution Resolution div mul neg 0 0]FontType 0
ne{/Metrics exch def dict begin Encoding{exch dup type/integertype ne{
pop pop 1 sub dup 0 le{pop}{[}ifelse}{FontMatrix 0 get div Metrics 0 get
div def}ifelse}forall Metrics/Metrics currentdict end def}{{1 index type
/nametype eq{exit}if exch pop}loop}ifelse[2 index currentdict end
definefont 3 -1 roll makefont/setfont cvx]cvx def}def/ObliqueSlant{dup
sin S cos div neg}B/SlantFont{4 index mul add}def/ExtendFont{3 -1 roll
mul exch}def/ReEncodeFont{CharStrings rcheck{/Encoding false def dup[
exch{dup CharStrings exch known not{pop/.notdef/Encoding true def}if}
forall Encoding{]exch pop}{cleartomark}ifelse}if/Encoding exch def}def
end

%%EndProcSet
%%BeginFont: CMSY10
%!PS-AdobeFont-1.1: CMSY10 1.0
%%CreationDate: 1991 Aug 15 07:20:57
% Copyright (C) 1997 American Mathematical Society. All Rights Reserved.
11 dict begin
/FontInfo 7 dict dup begin
/version (1.0) readonly def
/Notice (Copyright (C) 1997 American Mathematical Society. All Rights Reserved) readonly def
/FullName (CMSY10) readonly def
/FamilyName (Computer Modern) readonly def
/Weight (Medium) readonly def
/ItalicAngle -14.035 def
/isFixedPitch false def
end readonly def
/FontName /CMSY10 def
/PaintType 0 def
/FontType 1 def
/FontMatrix [0.001 0 0 0.001 0 0] readonly def
/Encoding 256 array
0 1 255 {1 index exch /.notdef put} for
dup 15 /bullet put
readonly def
/FontBBox{-29 -960 1116 775}readonly def
currentdict end
currentfile eexec
D9D66F633B846A97B686A97E45A3D0AA052F09F9C8ADE9D907C058B87E9B6964
7D53359E51216774A4EAA1E2B58EC3176BD1184A633B951372B4198D4E8C5EF4
A213ACB58AA0A658908035BF2ED8531779838A960DFE2B27EA49C37156989C85
E21B3ABF72E39A89232CD9F4237FC80C9E64E8425AA3BEF7DED60B122A52922A
221A37D9A807DD01161779DDE7D31FF2B87F97C73D63EECDDA4C49501773468A
27D1663E0B62F461F6E40A5D6676D1D12B51E641C1D4E8E2771864FC104F8CBF
5B78EC1D88228725F1C453A678F58A7E1B7BD7CA700717D288EB8DA1F57C4F09
0ABF1D42C5DDD0C384C7E22F8F8047BE1D4C1CC8E33368FB1AC82B4E96146730
DE3302B2E6B819CB6AE455B1AF3187FFE8071AA57EF8A6616B9CB7941D44EC7A
71A7BB3DF755178D7D2E4BB69859EFA4BBC30BD6BB1531133FD4D9438FF99F09
4ECC068A324D75B5F696B8688EEB2F17E5ED34CCD6D047A4E3806D000C199D7C
515DB70A8D4F6146FE068DC1E5DE8BC5703711DA090312BA3FC00A08C453C609
C627A8BECD6E1FA14A3B02476E90AAD8B4700C400380BC9AFFBF7847EB28661B
9DC3AA0F44C533F2E07DCC4DE19D367BF223E33DC321D0247A0E6EF6ABC8FA52
15AE044094EF678A8726CD7C011F02BFF8AB6EAEEE391AD837120823BED0B5D8
F8B15245377871A64F78378BB4330149D6941F7A86FBFFC49B93C94155F5FA7D
F22E7214511C0A92693F4CDBF38411651540572F2DD70D924AE0F18E1CD581F3
C871399127FF5D07A868885B5FF7CDEB50B8323B2533DEF8DC973B1AE84FA0A2

0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
cleartomark
%%EndFont 
TeXDict begin 40258431 52099146 1000 600 600 (fs-semantics.dvi)
@start /Fa 175[60 60 60 8[60 60 2[60 65[{TeXBase1Encoding ReEncodeFont}
6 99.6264 /Courier-Bold rf /Fb 240[42 15[{}1 83.022 /CMSY10
rf /Fc 139[28 3[46 42 46 69 23 2[23 3[37 3[42 23[32 16[42
42 42 42 42 42 1[42 2[21 46[{TeXBase1Encoding ReEncodeFont}18
83.022 /Times-Bold rf /Fd 133[44 50 1[72 50 55 33 39
44 1[55 50 55 83 28 55 33 28 55 50 33 44 55 44 55 50
12[66 55 72 1[61 78 72 94 3[39 78 3[72 72 1[72 7[50 50
50 50 50 50 50 50 50 50 28 25 33 25 41[55 2[{
TeXBase1Encoding ReEncodeFont}51 99.6264 /Times-Bold
rf /Fe 134[37 1[55 37 42 23 32 32 42 42 42 42 60 23 37
23 23 42 42 23 37 42 37 42 42 9[69 8[55 4[28 60 3[60
55 1[51 1[42 4[28 10[23 21 28 21 2[28 28 28 36[42 2[{
TeXBase1Encoding ReEncodeFont}41 83.022 /Times-Italic
rf /Ff 107[37 37 24[37 42 42 60 42 42 23 32 28 42 42
42 42 65 23 42 23 23 42 42 28 37 42 37 42 37 8[60 78
60 60 51 46 55 1[46 60 60 74 51 2[28 60 60 46 51 60 55
55 60 1[37 3[23 23 42 42 42 42 42 42 42 42 42 42 23 21
28 21 2[28 28 28 36[46 2[{TeXBase1Encoding ReEncodeFont}70
83.022 /Times-Roman rf /Fg 134[60 1[86 60 66 40 47 53
2[60 66 100 33 66 1[33 66 1[40 53 66 53 66 60 8[86 2[86
1[66 4[86 113 3[47 4[86 86 12[60 60 60 60 60 60 2[30
40 42[66 2[{TeXBase1Encoding ReEncodeFont}37 119.552
/Times-Bold rf /Fh 134[50 2[50 1[28 3[50 50 50 78 28
6[44 3[44 10[72 1[61 55 2[55 2[89 6[55 1[72 17[50 1[50
48[{TeXBase1Encoding ReEncodeFont}19 99.6264 /Times-Roman
rf /Fi 134[72 3[72 40 56 3[72 72 112 40 2[40 3[64 1[64
1[64 10[104 2[80 2[80 9[80 1[104 17[72 50[{
TeXBase1Encoding ReEncodeFont}18 143.462 /Times-Roman
rf end
%%EndProlog
%%BeginSetup
%%Feature: *Resolution 600dpi
TeXDict begin
%%BeginPaperSize: Letter
/setpagedevice where
{ pop << /PageSize [612 792] >> setpagedevice }
{ /letter where { pop letter } if }
ifelse
%%EndPaperSize
 end
%%EndSetup
%%Page: 1 1
TeXDict begin 1 0 bop 733 534 a Fi(PVFS)35 b(2)h(File)f(System)f
(Semantics)g(Document)1427 874 y Fh(PVFS)26 b(De)n(v)o(elopment)c(T)-7
b(eam)1743 1168 y(May)25 b(2002)42 1631 y Fg(1)120 b(Intr)n(oduction)42
1916 y Ff(This)22 b(document)d(describes)h(the)h(\002le)h(system)f
(semantics)g(of)g(PVFS2,)h(both)e(in)h(terms)g(of)g(ho)n(w)g(it)h(beha)
n(v)o(es)e(and)g(in)i(terms)f(of)g(ho)n(w)42 2016 y(this)g(beha)n(vior)
e(is)i(implemented.)i(Rationale)d(for)f(decisions)h(is)h(included)e(in)
h(order)f(to)h(moti)n(v)n(ate)g(decisions.)42 2215 y(W)-7
b(e)32 b(start)f(by)f(discussing)f(the)i(semantics)f(of)g(serv)o(er)g
(operations.)53 b(W)-7 b(e)32 b(follo)n(w)e(this)g(with)h(a)g
(discussion)e(of)i(one)e(client)i(side)42 2315 y(implementation)18
b(and)i(its)h(semantics.)42 2514 y(The)f(discussion)g(is)h(brok)o(en)e
(into)h(use)g(cases.)26 b(First)21 b(we)g(will)g(co)o(v)o(er)e(the)h
(issue.)26 b(Second)19 b(we)i(will)g(discuss)g(the)f(semantics)g(\(to)g
(be\))42 2614 y(implemented)h(in)j(PVFS2.)34 b(Finally)23
b(we)g(will)h(discuss)f(the)g(implications)f(of)h(these)g(semantics)g
(on)g(the)g(\002le)h(system)f(design)g(and)42 2713 y(implementation.)42
2912 y(In)d(some)g(cases)h(we)g(will)g(pro)o(vide)d(alternati)n(v)o(es)
h(for)h(semantics)g(and/or)f(the)h(implementation.)42
3292 y Fg(2)120 b(De\002nitions)42 3577 y Ff(W)-7 b(e)24
b(will)f(de\002ne)f Fe(o)o(verlapping)e(writes)k Ff(to)f(be)f
(concurrent)e(writes)j(that)f(modify)f(the)h(same)h(bytes)f(in)h(an)f
(object.)31 b(W)-7 b(e)23 b(will)h(de\002ne)42 3677 y
Fe(interleaved)f(writes)i Ff(to)e(be)g(concurrent)e(writes)j(that)f
(modify)f(dif)n(ferent)g(bytes)h(within)g(a)h(common)d(e)o(xtent)i(\(b)
n(ut)g(do)g(not)g(modify)42 3777 y(the)e(same)f(bytes\).)42
4157 y Fg(3)120 b(Ser)o(v)o(er)30 b(Semantics)42 4442
y Ff(In)21 b(this)h(section)f(we)h(discuss)g(the)f(semantics)h(that)f
(are)g(enforced)f(by)h(a)g(serv)o(er)g(with)h(respect)f(to)g
(operations)f(queued)g(for)g(service)42 4541 y(on)g(the)g(serv)o(er)-5
b(.)25 b(At)c(times)f(this)h(will)g(delv)o(e)e(do)n(wn)g(into)h(the)h
(tro)o(v)o(e)d(and/or)h(BMI)i(semantics.)42 4741 y(The)f(serv)o(er)f
(scheduler)g(component)f(is)j(responsible)e(for)h(enforcing)e(these)i
(semantics/policies.)42 4940 y Fe(Note:)26 b(we')n(r)m(e)20
b(not)g(counting)e(on)i(inter)n(-server)h(communication)d(at)i(this)h
(time)o(.)1926 5610 y Ff(1)p eop end
%%Page: 2 2
TeXDict begin 2 1 bop 42 169 a Fd(3.1)99 b(P)n(ermissions)25
b(and)g(permission)g(checking)42 424 y Ff(The)20 b(serv)o(er)f(will)i
(perform)e(an)o(y)g(permission)g(checking)g(on)g(incoming)g(operations)
f(before)h(queuing)f(them)i(for)g(service.)42 623 y(Permission)g
(checking)d(on)j(the)f(serv)o(er)g(is)i(limited)e(to)h(checking)e(that)
i(can)f(occur)g(on)g(the)h(object)f(itself)h(\(as)g(opposed)e(to)i
(checking)42 723 y(that)h(w)o(ould)e(occur)m(,)g(for)g(e)o(xample,)g
(to)h(v)o(erify)f(access)i(to)f(a)h(\002le)f(through)e(a)j(gi)n(v)o(en)
e(path\).)42 922 y(It')-5 b(s)21 b(not)f(clear)g(if)h(data\002les)f(ha)
n(v)o(e)g(permissions)f(yet.)42 1121 y(Operations)g(on)h(the)g
(meta\002le)h(use)f(the)g(permissions)g(on)f(the)i(meta\002le)f(at)h
(the)f(time)g(of)g(the)g(operation.)42 1321 y(Probably)f(data\002les)h
(don')o(t)f(ha)n(v)o(e)g(permissions)h(for)f(no)n(w)-5
b(.)42 1658 y Fd(3.2)99 b(Remo)o(ving)25 b(an)g(object)h(that)g(is)e
(being)h(accessed)42 1913 y Ff(The)h(serv)o(er)f(will)i(not)e(remo)o(v)
o(e)f(an)i(object)g(while)g(it)g(is)h(being)e(accessed.)42
b(F)o(or)26 b(e)o(xample,)g(if)g(a)g(tro)o(v)o(e)f(operation)f(is)j(in)
f(progress)42 2013 y(reading)j(data)h(from)f(a)i(data\002le,)h(the)e
(serv)o(er)f(will)i(queue)e(a)i(subsequent)d(remo)o(v)o(e)h(operation)f
(on)i(that)g(object)f(until)h(the)h(read)42 2112 y(operation)19
b(completes.)42 2312 y(The)i(serv)o(er)e(is)j(free)e(to)h(return)e
(\223no)h(such)h(\002le\224)g(results)g(to)g(future)e(operations)g(on)h
(that)h(object)f(e)n(v)o(en)g(if)g(it)i(has)f(not)f(completed)f(the)42
2411 y(remo)o(v)o(e)h(operation)h(\(assuming)f(that)j(permission)e
(checking)f(has)i(been)f(performed)f(to)i(v)o(erify)f(that)h(the)g
(remo)o(v)o(e)e(will)j(occur\))d(or)42 2511 y(to)f(queue)d(these)j
(operations)d(until)i(the)g(remo)o(v)o(e)f(has)h(occurred,)e(then)i
(allo)n(w)g(them)g(to)g(f)o(ail.)24 b(Ob)o(viously)17
b(the)h(\002rst)h(of)f(these)g(options)42 2611 y(is)j(preferable.)42
2948 y Fd(3.3)99 b(Ov)o(erlapping)25 b(writes)42 3203
y Ff(The)i(serv)o(er)f(will)h(allo)n(w)g(o)o(v)o(erlapping)c(and)k
(interlea)n(v)o(ed)e(writes)i(to)g(be)g(concurrently)d(processed)h(by)i
(the)g(underlying)d(storage)42 3303 y(subsystem)30 b(\(tro)o(v)o(e\).)
53 b(T)m(ro)o(v)o(e)29 b(will)i(ensure)e(that)i(in)f(the)h(interlea)n
(v)o(ed)d(case,)33 b(the)e(resulting)e(data)h(pattern)g(is)h(the)f
(union)f(of)h(the)42 3402 y(modi\002ed)19 b(bytes)g(of)g(both)g
(operations.)k(In)d(the)f(o)o(v)o(erlapping)e(case)j(tro)o(v)o(e)e(is)j
(free)e(to)g(ignore)g(all)h(b)n(ut)g(one)f(of)g(the)h(data)f(v)n(alues)
g(to)h(be)42 3502 y(written)g(to)h(each)e(byte)h(or)g(to)g(write)h
(them)f(all)g(in)h(some)f(unde\002ned)e(order)-5 b(.)42
3839 y Fd(3.4)99 b(Handle)25 b(r)n(euse)42 4095 y Ff(Serv)o(ers)d(will)
g(guarantee)f(that)h(handles)f(spend)g(a)i(minimum)d(amount)h(of)h
(time)g(out)g(of)g(use)g(before)f(the)o(y)g(are)h(reused.)30
b(This)22 b(time)42 4194 y(v)n(alue)e(will)h(be)f(kno)n(wn)f(to)h
(clients.)42 4515 y Fc(3.4.1)81 b(Implementation)42 4770
y Ff(Need)25 b(to)g(handle)f(the)h(case)g(where)g(a)g(handle)f(has)h
(been)g(used,)g(we')l(re)g(in)g(the)g(middle)f(of)h(this)g(w)o(ait)h
(time,)g(and)f(the)g(serv)o(er)f(gets)42 4870 y(restarted.)34
b(T)-7 b(o)23 b(handle)f(this)i(we)g(will)f(need)g(some)g(kind)f(of)h
(disk-resident)f(list)i(of)f(handles)g(along)f(with)h(some)g(lo)n(wer)g
(bound)e(on)42 4969 y(ho)n(w)f(recently)f(the)o(y)h(were)g(put)g(in)g
(the)g(unused)f(list.)1926 5610 y(2)p eop end
%%Page: 3 3
TeXDict begin 3 2 bop 42 169 a Fd(3.5)99 b(Symbolic)25
b(links)42 424 y Ff(Symbolic)19 b(links)i(will)g(be)f(stored)f(on)h
(serv)o(ers.)k(The)c(\223tar)o(get\224)f(of)h(the)g(link)g(need)g(not)g
(e)o(xist,)g(as)h(with)f(traditional)f(symlinks.)42 761
y Fd(3.6)99 b(T)-9 b(op)26 b(le)o(v)o(el)e(scheduler)i(semantics)42
1017 y Ff(Where)20 b(does)g(this)h(go?)42 1216 y(W)-7
b(e)22 b(need)f(a)g(list)h(of)f(types)g(of)g(operations)e(that)i
(shouldn')o(t)e(o)o(v)o(erlap.)25 b(This)c(is)h(the)f(rule)g(set)h(for)
e(the)h(scheduler)m(,)f(or)g(at)i(least)g(part)e(of)42
1315 y(it.)42 1695 y Fg(4)120 b(Client-side)31 b(library)f(without)h
(locks)f(or)g(inter)l(-client)h(communication)42 1980
y Ff(This)20 b(section)g(describes)g(what)g(will)g(be)g(our)g(\002rst,)
g(non-locking)d(approach)h(to)i(metadata)f(caching)g(that)h(does)g(not)
g(in)m(v)n(olv)o(e)e(client)42 2080 y(\002le)25 b(system)e(code)g
(communicating)e(with)j(other)f(client)h(instances.)35
b(This)24 b(scheme)f(relies)h(on)f(timeouts.)35 b(There)23
b(are)h(potentials)42 2180 y(for)c(inconsistencies,)f(just)i(as)g
(there)e(are)i(in)f(NFS,)h(if)f(the)g(timeouts)g(don')o(t)f(match)g
(well)i(with)f(access)h(patterns.)42 2379 y(Ob)o(viously)h(this)i(is)h
(just)f(one)f(of)g(man)o(y)g(possible)g(client-side)g(library)g
(implementations.)33 b(It)24 b(just)g(happens)e(to)i(be)g(the)f
(\002rst)i(one)42 2479 y(we')l(re)20 b(going)f(to)h(implement.)42
2678 y Fe(Note)h(the)f(oper)o(ations)f(at)h(this)h(le)o(vel)42
2877 y Ff(T)m(imeouts)26 b(will)h(be)f(tunable)f(at)i(runtime)e(to)i
(allo)n(w)f(administrators)f(to)h(tailor)g(their)g(system)h(to)f(the)h
(w)o(orkloads)e(presented.)41 b(A)42 2977 y(zero)20 b(timeout)f(is)j
(al)o(w)o(ays)e(possible,)g(meaning)f(that)h(that)g(type)g(of)g
(information)d(is)22 b(ne)n(v)o(er)c(cached.)42 3176
y(One)24 b(should)f(think)g(of)h(these)g(timeouts)g(as)h(pro)o(viding)c
(a)j(windo)n(w)f(of)h(time)g(during)f(which)g(the)h(vie)n(w)g(of)g(one)
f(client)h(can)g(dif)n(fer)42 3276 y(from)19 b(the)i(vie)n(w)f(of)g
(another)e(client.)25 b(There)20 b(are)g(a)g(number)f(of)h(aspects)g
(to)h(the)f(vie)n(w)g(of)g(interest:)167 3541 y Fb(\017)41
b Ff(attrib)n(utes)20 b(of)g(objects)167 3707 y Fb(\017)41
b Ff(locations)19 b(of)h(objects)g(in)h(the)f(name)f(space)167
3873 y Fb(\017)41 b Ff(e)o(xistence)19 b(of)h(objects)167
4039 y Fb(\017)41 b Ff(data)20 b(in)g(objects)42 4305
y(In)g(this)h(section)f(we)g(co)o(v)o(er)f(one)h(mechanism)f(for)g
(limiting)h(the)g(potential)g(inconsistencies)f(between)g(client)i(vie)
n(ws.)42 4504 y Fe(Do)g(we)f(want)h(some)f(kind)g(of)g(optional)f(data)
g(cac)o(hing?)k(If)d(so,)h(this)f(c)o(hang)o(es)f(our)h(concurr)m(ent)f
(write)j(model.)42 4842 y Fd(4.1)99 b(Caching)26 b(of)f(\002le)g(and)g
(dir)n(ectory)h(attrib)n(utes)42 5097 y Ff(The)31 b(most)f(ob)o(vious)f
(and)i(important)e(data)h(to)h(cache)g(from)e(a)i(performance)d
(standpoint)i(is)h(attrib)n(utes)g(associated)f(with)h(\002le)42
5197 y(system)22 b(objects.)31 b(Here)21 b(we)i(are)f(referring)e(to)i
(information)d(such)j(as)h(the)f(o)n(wner)f(and)g(group)g(of)g(the)h
(\002le,)h(the)f(permissions,)g(and)42 5296 y(PVFS-speci\002c)f
(information)d(lik)o(e)i(\002le)h(data)f(distrib)n(ution.)1926
5610 y(3)p eop end
%%Page: 4 4
TeXDict begin 4 3 bop 42 169 a Ff(W)-7 b(e)22 b(will)f(assume)f(that)g
(the)g(data)g(distrib)n(ution)f(for)h(a)g(\002le)h(does)f(not)g(change)
f(o)o(v)o(er)g(the)h(lifetime)g(of)g(the)g(\002le)h(\(?\).)42
368 y(A)g(timeout)e(will)i(be)g(associated)e(with)i(this)g
(information.)42 567 y(Implications)e(on)h(\002le)h(size.)42
888 y Fc(4.1.1)81 b(Implementation)42 1143 y Ff(Possible)21
b(to)f(use)h(vtags)f(for)f(v)o(eri\002cation)g(that)h(data)g(hasn')o(t)
f(changed.)42 1480 y Fd(4.2)99 b(Caching)26 b(of)f(dir)n(ectory)g
(hierar)n(ch)o(y)42 1736 y Ff(Implications)19 b(on)h(renaming)e(of)i
(\002les,)h(directories,)e(parent)g(directories.)42 2073
y Fd(4.3)99 b(Handle)25 b(r)n(euse)42 2328 y Ff(It)30
b(is)g(important)e(that)h(clients)g(be)h(able)f(to)g(identify)f(when)h
(a)g(handle)f(has)i(been)e(reused)h(by)g(the)g(system)g(and)g(is)h(no)f
(longer)f(a)42 2428 y(reference)d(to)i(the)f(original)g(object.)43
b(Gi)n(v)o(en)26 b(a)h(\002nite)g(handle)e(space,)j(we)f(kno)n(w)f
(that)g(we)h(will)g(e)n(v)o(entually)e(run)h(out)g(of)g(unique)42
2528 y(handles)20 b(and)f(ha)n(v)o(e)h(to)g(reuse)g(old,)g(freed)f
(ones.)42 2727 y(W)-7 b(e)27 b(will)g(impose)e(a)h(timeout)f(on)g
(reuse)g(of)h(handles)f(by)g(serv)o(ers)g(in)h(order)e(to)i(allo)n(w)g
(clients)g(to)g(ha)n(v)o(e)f(an)g(e)o(xpectation)f(of)i(ho)n(w)42
2826 y(long)19 b(the)o(y)f(can)h(hold)f(onto)h(handle)f(data)h(while)g
(assuming)g(that)g(the)g(handle)f(still)i(refers)f(to)g(the)h(same)f
(object)g(\(if)g(it)h(is)g(still)g(v)n(alid\).)42 2926
y(This)h(timeout)e(will)i(create)f(a)h(windo)n(w)e(of)h(time)g(during)f
(which)g(a)i(client)f(can)g(detect)g(that)g(the)h(handle)e(has)h(been)g
(freed.)42 3125 y(This)h(timeout)e(should)g(be)h(quite)g(lar)o(ge)f(so)
i(that)f(it)h(in)g(general)e(does)h(not)f(af)n(fect)h(the)g(client.)42
3325 y(Note)g(need)g(for)g(re)n(visiting)f(client)h(code)g(to)g(allo)n
(w)g(for)g(refresh.)42 3524 y(If)f(this)h(timeout)e(does)h(occur)m(,)f
(then)g(the)h(client)g(needs)g(to)g(check)g(to)g(see)g(if)h(the)f
(handle)f(that)h(it)h(has)f(still)h(refers)f(to)g(the)g(same)h(object)
42 3623 y(as)25 b(before.)34 b(This)23 b(can)h(be)f(done)g(by)g
(comparing)f(the)h(create)h(time)f(of)h(the)f(cached)g(object)g(handle)
g(with)h(the)f(create)h(time)g(stored)42 3723 y(on)i(the)g(serv)o(er)-5
b(.)43 b(Create)26 b(times)h(will)g(be)f(accurate)f(and)h
(nonmodi\002able)d(on)j(serv)o(ers.)42 b(An)27 b(equality)e(test)i(can)
f(be)g(used)g(for)f(this)42 3823 y(test;)20 b(this)f(a)n(v)n(oids)g
(potential)e(problems)g(with)i(clock)f(sk)o(e)n(w/reset.)24
b(It)19 b(does)f(not)g(imply)g(that)h(clocks)f(must)g(be)h(in)f(sync)g
(between)g(the)42 3922 y(v)n(arious)h(serv)o(ers.)42
4122 y(Name)h(the)h(timeout.)42 4442 y Fc(4.3.1)81 b(Implementation)42
4698 y Ff(Serv)o(er)23 b(must)g(k)o(eep)g(a)h(time)g(associated)f(with)
h(freed)e(handles.)34 b(Groups)22 b(of)i(handles)e(can)i(be)f(put)g
(together)f(with)i(a)g(single)f(time,)42 4797 y(because)g(our)g(space)h
(is)g(big)f(enough)f(that)i(this)g(shouldn')o(t)d(be)j(a)g(problem.)33
b(This)24 b(will)g(need)f(to)h(be)f(written)h(to)f(disk)h(so)g(that)f
(this)42 4897 y(polic)o(y)c(can)h(be)g(upheld)f(in)i(the)f(f)o(ace)g
(of)g(a)g(restart.)42 5096 y(W)-7 b(e)20 b(should)d(do)h(the)h(math)f
(on)g(ho)n(w)g(long)g(we)g(should)g(w)o(ait,)h(w)o(ork)f(out)g(the)h
(speci\002cs)g(of)f(what)g(goes)g(to)h(disk)f(\(ho)n(w)g(it)h(goes)f
(to)h(disk)42 5196 y(doesn')o(t)g(ha)n(v)o(e)h(to)g(be)g(here\).)1926
5610 y(4)p eop end
%%Page: 5 5
TeXDict begin 5 4 bop 42 169 a Ff(On)20 b(the)h(client)f(side,)g(we)g
(will)h(w)o(ant)f(the)h(ability)e(to)i(get)f(control)f(to)h(the)g
(client)g(code)g(e)n(v)o(en)f(if)h(there)g(aren')o(t)f(ops)h(to)g
(perform.)j(This)42 268 y(could)c(be)g(a)h(function)d(call,)j(or)f
(there)g(could)f(be)h(a)h(thread)e(in)i(the)f(client)h(code,)e(or)h
(maybe)f(the)i(client)f(code)g(is)h(its)g(o)n(wn)f(entity)g(\(e.g.)42
368 y(pvfsd\).)24 b(All)d(options)e(to)h(list)i(here.)42
705 y Fd(4.4)99 b(Metadata)26 b(not)f(in)g(cache)42 961
y Ff(A)g(common)d(occurrence)f(in)j(PVFS1)h(is)g(that)e(one)h(client)g
(will)g(create)g(a)g(\002le)h(that)f(is)h(subsequently)d(accessed)h(by)
h(a)g(number)e(of)42 1060 y(other)c(clients.)24 b(It)19
b(is)g(important)d(semantically)i(that)g(it)h(is)g(ne)n(v)o(er)e(the)h
(case)g(that)h(an)f(e)o(xplicit)f(attempt)h(to)g(access)h(a)g(recently)
e(created)42 1160 y(\002le)k(f)o(ails)f(because)f(of)h(our)f(caching)f
(polic)o(y)-5 b(.)23 b(Because)d(of)g(this,)g(an)o(y)f(time)h(a)g
(\002le)g(system)g(object)f(is)i(e)o(xplicitly)e(referenced)e(that)j
(is)42 1259 y(not)h(in)g(the)h(cache,)e(we)i(will)g(assume)f(that)g
(the)g(cache)g(is)h(not)f(up)f(to)i(date)f(\(re)o(gardless)e(of)i(the)g
(timeout)f(v)n(alues)h(described)f(abo)o(v)o(e\))42 1359
y(and)26 b(attempt)f(to)h(obtain)f(metadata)g(for)g(the)h(object.)41
b(Only)25 b(if)h(this)g(f)o(ails)h(will)f(we)h(return)d(an)i(error)e
(indicating)h(that)h(the)g(object)42 1459 y(does)20 b(not)g(e)o(xist.)
42 1658 y(This)h(is)f(an)g(instance)g(of)g(an)g(implicit)g(hint)g(from)
f(the)h(user)g(that)g(something)e(in)j(the)f(cache)f(might)h(not)f(be)h
(up)g(to)g(date.)25 b(W)-7 b(e)21 b(should)42 1758 y(consider)e(where)h
(other)f(such)h(hints)g(occur)-5 b(.)69 1957 y Fe(Any)27
b(time)g(a)g(r)m(equest)f(is)i(r)m(eceived)e(on)g(a)h(client)g(to)f
(oper)o(ate)g(on)g(a)h(\002le)f(system)i(object)e(that)g(is)i(not)e
(known)g(to)h(the)g(client-side)42 2056 y(cac)o(he)o(,)19
b(the)i(client)f(will)h(attempt)f(to)g(r)m(etrie)o(ve)h(metadata)e(for)
h(the)h(object.)42 2394 y Fd(4.5)99 b(Concurr)n(ent,)28
b(byte-o)o(v)o(erlapping)d(writes)g(to)g(a)g(single)g(\002le)42
2649 y Ff(One)19 b(of)g(the)f(most)h(incon)m(v)o(enient)d(of)i(the)h
(POSIX)g(I/O)g(semantics)g(is)h(its)g(speci\002cation)e(of)g(ho)n(w)h
(concurrent,)d(o)o(v)o(erlapping)g(writes)42 2749 y(should)22
b(be)h(handled.)32 b(T)-7 b(o)23 b(be)g(POSIX)h(compliant,)e
(sequential)g(consistenc)o(y)g(must)h(be)g(maintained)f(in)h(the)g(f)o
(ace)g(of)g(concurrent,)42 2848 y(o)o(v)o(erlapping)17
b(writes.)42 3047 y(In)i(PVFS1)h(we)f(didn')o(t)e(support)h(this)i
(semantic.)k(The)19 b(premise)f(w)o(as)i(that)f(application)e
(programmers)g(are)i(not)f(really)h(doing)f(this,)42
3147 y(that)26 b(a)f(well-written)g(application)f(does)h(not)g(ha)n(v)o
(e)f(multiple)h(processes)g(writing)g(to)g(the)g(same)h(bytes)f(in)g
(the)h(\002le.)40 b(Instead)25 b(the)42 3247 y(PVFS1)i(semantics)f
(said)g(that)g(writes)g(that)g(do)g(not)f(ha)n(v)o(e)h(o)o(v)o
(erlapping)c(bytes)k(will)h(occur)d(e)o(xactly)h(as)i(requested,)f(e)n
(v)o(en)f(if)h(the)42 3346 y(bytes)19 b(are)g(interlea)n(v)o(ed,)e(b)n
(ut)i(that)g(if)g(o)o(v)o(erlapping)d(does)j(occur)f(the)g(result)h
(can)g(be)g(an)o(y)f(combination)f(of)h(the)h(bytes)g(from)f(the)h(tw)o
(o)42 3446 y(writers.)42 3645 y(In)27 b(practice)e(we)i(ha)n(v)o(e)f
(found)f(with)i(PVFS1)g(that)f(while)h(some)f(people)g(seem)g
(concerned)f(that)h(we)h(do)f(not)h(meet)f(the)h(POSIX)42
3745 y(semantics,)19 b(no)g(actual)g(application)e(groups)h(ha)n(v)o(e)
h(pointed)e(to)j(this)f(as)h(a)f(sho)n(w-stopper)-5 b(.)23
b(Perhaps)c(some)g(DB)h(groups)d(ha)n(v)o(e)i(been)42
3845 y(concerned,)g(b)n(ut)i(then)g(PVFS)h(is)g(really)f(poorly)e
(designed)h(for)h(the)g(types)g(of)g(patterns)f(that)h(these)h
(applications)e(w)o(ould)g(produce)42 3944 y(an)o(yw)o(ay)f
(\(probably\).)42 4143 y(F)o(or)h(these)g(reasons)g(we)h(will)g(be)o
(gin)e(in)h(PVFS2)h(with)f(the)g(same)h(concurrent,)c(o)o(v)o
(erlapping)g(write)j(semantics.)42 4343 y Fe(Concurr)m(ent,)k(non-o)o
(verlapping)19 b(writes)26 b(will)e(r)m(esult)g(in)g(the)g(desir)m(ed)f
(data)g(being)f(written)j(to)e(disk)h(r)m(e)m(gar)m(dless)f(of)h
(interleaving)42 4442 y(of)d(data)f(down)f(to)i(the)f(byte)h(gr)o
(anularity)-5 b(.)24 b(Concurr)m(ent,)c(o)o(verlapping)e(writes)k(\(at)
f(the)f(byte)g(le)o(vel\))h(will)g(r)m(esult)g(in)g(data)e(fr)l(om)j
(one)42 4542 y(of)e(the)g(r)m(equests)g(being)e(written)j(to)f(eac)o(h)
f(byte)g(in)h(the)g(\002le)o(,)f(b)n(ut)h(for)g(e)o(very)g(given)f
(byte)h(the)f(data)g(written)i(could)d(be)i(fr)l(om)g(any)g(one)42
4642 y(of)h(the)f(concurr)m(ent)f(oper)o(ations.)42 4962
y Fc(4.5.1)81 b(Implementation)42 5217 y Ff(W)-7 b(e)25
b(will)e(assume)h(that)f(tro)o(v)o(e)f(is)i(able)f(to)g(handle)f(the)h
(interlea)n(v)o(ed)f(writes)i(and)e(support)g(these)h(semantics,)h(so)f
(the)h(higher)d(le)n(v)o(el)42 5317 y(components)d(of)i(the)g(serv)o
(er)g(may)f(pass)i(do)n(wn)e(an)o(y)h(combination)e(of)i(writes)g(that)
g(it)h(lik)o(es.)1926 5610 y(5)p eop end
%%Page: 6 6
TeXDict begin 6 5 bop 42 169 a Fd(4.6)99 b(Concurr)n(ent)28
b(\002le)d(cr)n(eate)42 424 y Ff(This)c(happens)d(all)j(the)f(time)h
(in)f(parallel)g(applications,)f(e)n(v)o(en)g(with)h(R)m(OMIO)g(at)h
(the)f(moment.)42 623 y(Only)g(one)g(instance)g(must)h(be)f(created.)26
b(Ev)o(eryone)17 b(must)k(then)f(get)h(the)f(right)g(handle.)25
b(When)20 b(a)h(handle)e(is)j(returned,)c(it)k(must)e(be)42
723 y(ready)f(to)i(be)f(used)g(for)f(I/O.)42 1042 y Fc(4.6.1)81
b(Implementation)42 1298 y Ff(T)-7 b(o)25 b(create)g(a)h(PVFS2)f
(\223\002le\224,)h(there)f(are)g(actually)f(three)g(things)h(that)g(ha)
n(v)o(e)f(to)i(happen.)37 b(A)26 b(meta\002le)f(must)g(be)f(created)h
(to)g(hold)42 1397 y(attrib)n(utes.)f(A)19 b(collection)f(of)g
(data\002les)g(must)g(be)h(created)e(to)i(hold)e(the)h(data.)24
b(A)19 b(dirent)f(in)g(the)g(parent)g(directory)e(must)j(be)f(created)
42 1497 y(to)j(add)e(the)h(\002le)h(into)f(the)g(name)g(space.)42
1696 y(There)g(are)g(a)g(b)n(unch)f(of)h(options)g(for)f(implementing)f
(this)j(correctly:)167 1956 y Fb(\017)41 b Ff(dirent)19
b(\002rst)167 2120 y Fb(\017)41 b Ff(dirent)19 b(second)167
2283 y Fb(\017)41 b Ff(dirent)19 b(last)167 2446 y Fb(\017)41
b Ff(hash)20 b(to)g(meta\002le)167 2610 y Fb(\017)41
b Ff(serv)o(er)n(-supported)17 b(w/serv)o(er)i(communication)42
2870 y(In)h(the)g(\002rst)h(four)e(schemes,)h(the)g(clients)h(are)f
(totally)g(responsible)f(for)g(creating)h(all)g(the)h(components)d(of)i
(a)g(PVFS2)h(\002le.)42 3069 y(In)j(the)h(dirent)f(\002rst)h(scheme,)g
(the)f(dirent)g(is)h(created)f(as)h(the)g(\002rst)g(step.)38
b(F)o(ollo)n(wing)23 b(this)i(the)g(other)e(objects)h(are)h(allocated)f
(and)42 3169 y(\002lled)j(in.)43 b(The)26 b(adv)n(antage)e(of)i(this)g
(approach)e(is)j(that)g(clients)f(that)g(lose)h(the)f(race)g(to)g
(create)g(the)g(\002le)h(will)g(do)f(so)g(on)g(the)g(\002rst)42
3268 y(step)20 b(\(as)g(opposed)e(to)i(the)f(dirent)g(last)h(case,)g
(described)e(belo)n(w\).)24 b(This)c(means)f(that)h(the)f(minimum)f
(amount)g(of)i(redundant)d(w)o(ork)42 3368 y(occurs.)24
b(Ho)n(we)n(v)o(er)m(,)17 b(the)h(dirent)g(can')o(t)f(e)n(v)o(en)h(ha)n
(v)o(e)f(a)i(v)n(alid)f(handle)g(in)g(it)h(if)g(it)g(is)h(created)d
(\002rst,)j(meaning)d(that)h(the)h(dirent)e(will)j(ha)n(v)o(e)42
3468 y(to)k(be)f(modi\002ed)f(a)i(second)f(time)g(by)g(the)g(creator)g
(to)g(\002ll)i(in)e(the)g(right)g(v)n(alue)g(\(once)f(the)h(meta\002le)
h(is)g(allocated\).)34 b(This)23 b(lea)n(v)o(es)h(a)42
3567 y(windo)n(w)19 b(of)h(time)h(during)d(which)i(the)g(dirent)g(e)o
(xists)g(b)n(ut)g(refers)g(to)g(a)h(\002le)g(that)f(has)h(no)e(attrib)n
(utes)i(and)e(cannot)g(be)h(read.)42 3767 y(In)j(the)h(dirent)e(second)
h(scheme,)g(clients)h(\002rst)g(allocate)f(a)g(meta\002le)h(with)f
(parameters)f(indicating)g(that)i(it)g(isn')o(t)f(complete,)f(then)42
3866 y(allocate)j(the)f(dirent.)38 b(This)25 b(means)f(that)h(losing)f
(clients)h(will)h(all)f(allocate)f(a)h(meta\002le)g(\(and)f(then)g(ha)n
(v)o(e)g(to)h(free)f(it\).)39 b(Ho)n(we)n(v)o(er)m(,)42
3966 y(it)24 b(also)e(pro)o(vides)f(a)i(v)n(alid)f(set)h(of)g(attrib)n
(utes)f(that)h(could)e(be)h(seen)h(during)e(the)h(windo)n(w)g(of)g
(time)h(that)f(the)h(\002le)g(is)g(being)f(created.)42
4065 y(Data\002les)h(w)o(ould)f(be)g(allocated)g(last,)i(meaning)d
(that)h(the)h(client)f(w)o(ould)g(ha)n(v)o(e)f(to)i(modify)e(the)h
(distrib)n(ution)f(information)f(in)j(the)42 4165 y(meta\002le)d(after)
f(it)h(has)g(been)f(added)f(into)i(the)f(namespace;)g(ho)n(we)n(v)o(er)
m(,)e(a)j(v)n(alid)f(handle)f(w)o(ould)h(already)f(e)o(xist)i(in)g(the)
f(name)g(space,)42 4265 y(resulting)25 b(in)i(a)f(cleaner)f
(client-side)h(mechanism)e(for)i(updating)e(the)i(distrib)n(ution)f
(information)e(once)j(it)g(is)h(\002lled)g(in.)42 b(Clients)42
4364 y(attempting)17 b(to)h(read/write)f(a)h(\002le)g(with)g(cached)f
(distrib)n(ution)g(information)e(that)j(isn')o(t)f(\002lled)h(in)g
(will)h(necessarily)e(need)g(to)h(update)42 4464 y(their)i(cache)g(and)
g(potentially)e(w)o(ait)j(for)f(this)h(to)f(\002nish.)42
4663 y(In)e(the)f(dirent)g(last)i(scheme)e(clients)h(\002rst)g
(allocate)g(data\002les,)g(then)f(the)h(meta\002le)f(\(\002lling)g(in)h
(the)g(distrib)n(ution)e(information\),)f(then)42 4763
y(\002nally)21 b(\002ll)h(in)f(the)g(dirent.)27 b(This)21
b(scheme)g(has)g(the)g(bene\002t)g(of)g(at)g(all)h(times)f(pro)o
(viding)e(a)i(consistent,)g(complete)f(name)g(space.)28
b(It)42 4862 y(has)c(the)f(dra)o(wback)e(of)i(a)g(lot)g(of)g(w)o(ork)g
(on)f(the)h(client)g(side)h(for)e(the)h(losers)h(to)f(\223undo\224)e
(all)j(the)f(allocation)f(that)h(the)o(y)g(performed)42
4962 y(before)c(f)o(ailing)h(to)g(obtain)f(the)i(dirent.)42
5161 y(The)h(hash)g(to)h(meta\002le)f(scheme)g(relies)g(on)g(the)g(use)
h(of)f(the)g(v)o(esta-lik)o(e)f(hashing)h(scheme)f(for)h(directly)f
(\002nding)g(meta\002les.)32 b(This)42 5261 y(scheme)20
b(is)h(listed)g(here)e(just)i(to)f(k)o(eep)g(it)g(in)h(mind;)e(we)i
(don')o(t)d(e)o(xpect)h(to)i(use)f(the)g(hashing)f(scheme)h(at)g(this)h
(time.)k(In)20 b(this)g(scheme)42 5361 y(the)25 b(meta\002le)g(is)h
(created)e(\002rst.)39 b(Since)25 b(all)h(clients)f(will)g(hash)g(to)g
(the)g(same)g(serv)o(er)m(,)f(and)h(a)g(path)f(name)h(is)g(associated)g
(with)g(the)1926 5610 y(6)p eop end
%%Page: 7 7
TeXDict begin 7 6 bop 42 169 a Ff(meta\002le)17 b(\(in)f(this)h
(scheme\),)f(the)h(serv)o(er)e(w)o(ould)h(allo)n(w)g(only)g(one)g
(meta\002le)h(to)f(be)h(created.)22 b(After)17 b(this)g(the)f(winner)g
(could)f(allocate)42 268 y(data\002les)23 b(and)f(\002nally)h(create)f
(the)h(dirent.)31 b(It')-5 b(s)23 b(not)g(a)g(bad)f(scheme,)g(b)n(ut)h
(we')l(re)f(not)g(doing)f(the)i(hashing)e(right)h(no)n(w)g(because)g
(of)42 368 y(costs)f(in)f(other)g(operations.)42 567
y(In)k(the)f(last)i(scheme)e(serv)o(er)g(communication)e(is)k(used)e
(to)h(coordinate)e(creation)h(of)g(all)h(the)g(objects)g(that)f(mak)o
(e)h(up)f(a)h(\002le.)36 b(The)42 667 y(serv)o(er)24
b(holding)f(the)i(directory)e(is)i(told)f(to)h(create)g(the)f(PVFS)i
(\002le.)39 b(It)25 b(creates)f(the)h(meta\002le)g(and)f(data\002les)h
(before)e(adding)g(the)42 766 y(dirent.)h(The)c(serv)o(er)g(scheduler)f
(can)h(ensure)f(that)h(only)g(one)f(create)h(completes.)42
966 y Fe(W)-8 b(e)21 b(will)h(implement)d(the)i(dir)m(ent)f(second)f
(sc)o(heme)o(.)42 1303 y Fd(4.7)99 b(Mo)o(ving)25 b(\002les)42
1558 y Ff(Concurrent)c(mo)o(v)o(es)h(can)h(be)f(trick)o(y)-5
b(.)32 b(The)22 b(biggest)g(concern)g(is)h(eliminating)f(an)o(y)g
(point)g(during)f(which)i(a)g(\002le)g(might)g(ha)n(v)o(e)f(tw)o(o)42
1658 y(references)d(in)h(the)h(namespace.)42 1857 y(A)g(secondary)d
(concern)h(is)i(that)f(of)g(a)h(concurrent)d(create)h(of)h(the)h
(destination)e(\002le)i(while)f(the)g(mo)o(v)o(e)f(is)i(in)f(progress.)
42 2178 y Fc(4.7.1)81 b(Implementation)42 2433 y Ff(Clients)21
b(will)g(perform)d(mo)o(v)o(es)h(in)i(the)f(follo)n(wing)f(w)o(ay:)167
2699 y Fb(\017)41 b Ff(delete)20 b(original)f(dentry)167
2865 y Fb(\017)41 b Ff(create)20 b(ne)n(w)g(dentry)42
3131 y(By)h(performing)c(the)j(operations)f(in)h(this)h(order)m(,)d(we)
j(preserv)o(e)e(the)h(\223no)g(more)f(than)h(one)f(reference\224)g
(semantic)h(listed)g(abo)o(v)o(e.)42 3330 y Fe(Need)h(to)f(handle)f
(the)h(cr)m(eate/mo)o(ve)g(in)g(some)g(way)-5 b(.)26
b(How?)42 3529 y Ff(A)g(second)e(approach)f(is)j(possible)f(gi)n(v)o
(en)f(inter)n(-serv)o(er)f(communication.)37 b(In)24
b(this)i(approach,)e(a)h(scheme)g(can)g(be)g(applied)f(that)42
3629 y(eliminates)d(the)f(create/mo)o(v)o(e)e(problem.)24
b(In)c(this)h(description)e(we)h(denote)g(the)g(serv)o(er)g(that)g
(originally)f(holds)h(the)g(dentry)f(as)i(sv1)42 3728
y(and)f(the)g(ne)n(w)g(holder)f(of)h(the)g(dirent)g(as)g(sv2.)167
3994 y Fb(\017)41 b Ff(sv1)20 b(recei)n(v)o(es)f(mo)o(v)o(e)g(request)
167 4160 y Fb(\017)41 b Ff(sv1)20 b(ensures)g(no)f(other)h(operations)e
(will)j(proceed)e(on)h(old)g(dirent)f(until)h(complete)f(\(through)f
(scheduler\))167 4326 y Fb(\017)41 b Ff(sv1)20 b(creates)g(ne)n(w)g
(dirent)g(on)f(sv2)167 4492 y Fb(\017)41 b Ff(on)20 b(success,)g
(deletes)g(original)f(dirent)167 4658 y Fb(\017)41 b
Ff(on)20 b(f)o(ailure,)f(returns)g(f)o(ailure)h(to)g(client)42
4995 y Fd(4.8)99 b(Deleting)26 b(a)e(\002le)h(that)h(is)e(being)i
(accessed)42 5251 y Ff(POSIX)33 b(semantics)f(dictate)g(that)h(a)f
(\002le)h(deleted)f(while)g(held)g(open)f(by)h(another)f(process)g
(remains)h(a)n(v)n(ailable)g(through)e(the)42 5350 y(reference)19
b(that)h(the)g(process)g(holds)g(until)g(the)g(process)g(dies)g(or)g
(closes)h(the)f(\002le)h(\(v)o(erify)d(that)i(this)h(is)g(a)g(POSIX)g
(thing\).)1926 5610 y(7)p eop end
%%Page: 8 8
TeXDict begin 8 7 bop 42 169 a Ff(PVFS1)21 b(actually)f(attempts)g(to)g
(support)f(this)i(semantic.)42 368 y(W)-7 b(e)29 b(will)f(not)f(try)g
(to)h(support)e(this)i(in)g(PVFS2.)47 b(Clients)28 b(with)g(it)g(open)e
(will)j(all)f(of)f(a)h(sudden)e(get)h(ENOFILE)g(or)g(something)42
468 y(similar)-5 b(.)27 b(T)-7 b(oo)20 b(much)f(state)i(must)g(be)f
(maintained)f(to)i(pro)o(vide)d(this)j(functionality)d(\(either)i(on)g
(client)g(or)h(serv)o(er)e(side\).)26 b(W)-7 b(e')l(re)20
b(not)42 567 y(going)j(to)h(do)g(this)g(sort)g(of)g(thing)f(on)h(the)g
(serv)o(er)f(side,)i(so)f(unless)g(we)h(ha)n(v)o(e)e(communicating)e
(clients,)k(we)g(aren')o(t)d(going)h(to)h(get)42 667
y(this)d(beha)n(vior)-5 b(.)42 988 y Fc(4.8.1)81 b(Implementation)42
1243 y Ff(Delete)21 b(the)f(dirent)f(\002rst,)i(then)f(the)g
(meta\002le,)g(then)g(the)g(data\002les.)25 b(I)c(think.)42
1580 y Fd(4.9)99 b(P)n(ermissions)25 b(and)g(permission)g(checking)42
1835 y Ff(Whole)f(path)f(permission)g(checking)f(is)i(performed)d(at)j
(lookup)e(time)i(\(i.e.)35 b(when)23 b(someone)g(attempts)g(to)h(get)g
(a)g(handle\).)34 b(This)42 1935 y(will)21 b(v)o(erify)e(that)h(the)o
(y)g(can)g(read)f(the)i(metadata.)42 2134 y(Object-le)n(v)o(el)d
(permission)g(checking)f(will)j(be)f(performed)d(at)k(read/write.)j
(This)c(is)h(when)f(we)g(determine)f(if)h(the)g(user)g(can)f(access)42
2234 y(data.)25 b(An)20 b(implication)f(of)h(this)g(is)h(that)f(at)g
(the)g(UNIX)h(le)n(v)o(el)e(successfully)g(opening)g(a)h(\002le)h(for)e
(writing)g(does)h(not)g(guarantee)e(that)42 2334 y(the)j(user)f(will)h
(continue)d(to)j(be)f(able)g(to)g(write)g(to)h(the)f(\002le)h(through)d
(the)i(\002le)h(descriptor)-5 b(.)42 2533 y(Both)21 b(of)e(these)i
(check)o(ed)e(are)h(performed)d(using)j(cached)f(data.)42
2732 y(Meta\002le)i(operations)d(get)j(meta\002le)f(permission)f
(checks)h(using)f(cached)h(data.)42 2931 y(W)-7 b(e)22
b(should)d(look)g(at)i(N)m(AS)g(authentication)d(mechanisms)h(and)h
(try)g(to)g(\002nd)g(one)g(that)g(we)h(can)f(le)n(v)o(erage)e(as)j(a)g
(future)e(project.)42 3269 y Fd(4.10)99 b(Readdir)26
b(with)f(concurr)n(ent)i(dir)n(ectory)f(changes)42 3524
y Ff(Vtags)21 b(will)g(be)f(used)g(to)g(ensure)g(that)g(directory)e
(changes)h(are)i(noticed)e(on)h(client)g(side.)42 3723
y(This)h(means)f(that)g(we)g(need)g(a)g(vtag)g(parameter)f(in)h(the)g
(request.)42 3922 y(W)-7 b(e)22 b(will)f(restart)f(the)g(directory)e
(read)i(process)g(in)g(the)g(e)n(v)o(ent)g(of)g(a)g(change.)42
4260 y Fd(4.11)99 b(T)n(ime)26 b(synchr)n(onization)42
4515 y Ff(NO)m(TE:)c(F)o(or)g(no)n(w)g(we)h(are)f(setting)g(ctime,)h
(atime,)f(and)g(mtime)g(at)h(creation)e(using)h(time)g(v)n(alues)g
(computed)e(on)i(the)h(client)f(side.)42 4615 y(W)-7
b(e)22 b(may)d(need)h(to)g(change)f(this)i(later)-5 b(...)42
4814 y(Ho)n(w)24 b(do)f(we)i(get)f(the)f(atimes)i(and)e(mtimes)h(right)
f(for)g(\002les?)37 b(Do)24 b(we)g(mak)o(e)g(this)g(a)g(deri)n(v)o(ed)e
(v)n(alue)i(\(as)g(in)g(PVFS1\)?)36 b(If)24 b(so,)h(we)42
4913 y(need)e(to)g(ha)n(v)o(e)g(tight)g(clock)f(synchronization,)f(or)h
(we)i(need)e(some)h(w)o(ay)g(for)g(adjusting)f(for)h(clock)f(sk)o(e)n
(w)h(\(e.g.)34 b(passing)22 b(current)42 5013 y(time)f(plus)f(atime)g
(or)g(mtime,)g(letting)g(serv)o(er)f(do)h(the)g(math\).)1926
5610 y(8)p eop end
%%Page: 9 9
TeXDict begin 9 8 bop 42 169 a Fd(4.12)99 b(Computing)26
b(\002le)f(size)42 424 y Ff(Ho)n(w?)g(It')-5 b(s)20 b(a)h(deri)n(v)o
(ed)c(v)n(alue.)25 b(If)19 b(no)g(serv)o(er)g(communication,)e(then)i
(we')o(ll)h(need)f(to)h(talk)g(to)g(all)g(the)g(o)n(wners)e(of)i
(data\002les)g(and)f(get)42 524 y(their)h(sizes,)h(then)f(do)g(some)g
(dist-speci\002c)g(math)f(to)i(get)f(the)g(actual)g(size.)42
723 y(When)g(do)g(we)h(w)o(ant)f(to)h(ensure)e(that)i(the)f(\002le)h
(size)g(is)g(e)o(xact?)k(What)c(does)f(truncate)f(do)h(WR)-5
b(T)21 b(the)g(data\002les?)k(Does)c(it)g(just)f(mak)o(e)42
823 y(sure)e(that)f(the)h(right)f(one)f(is)j(big)e(enough)e(to)j(sho)n
(w)f(that)h(the)f(\002le)h(should)f(be)g(so)h(big,)g(or)f(do)g(we)h(do)
f(something)f(to)h(all)h(the)g(data\002les?)42 1160 y
Fd(4.13)99 b(Non-blocking)26 b(calls)42 1415 y Ff(W)-7
b(e)22 b(should)d(ha)n(v)o(e)g(some)h(for)g(read/write)f(in)i(addition)
e(to)h(the)g(blocking)e(calls.)42 1614 y(W)-7 b(e)22
b(may)d(w)o(ant)i(a)f(thread)g(under)e(the)j(API)f(to)g(handle)f
(progress.)42 1994 y Fg(5)120 b(UNIX-lik)o(e)31 b(interface)42
2279 y Ff(In)22 b(this)g(section)g(we)g(describe)f(the)h(implications)e
(of)i(the)g(serv)o(er)f(semantics)g(and)h(caching)e(client)i(semantics)
g(on)f(a)h(hypothetical)42 2379 y(UNIX-lik)o(e)e(interf)o(ace.)42
2578 y Fe(Note)h(the)f(oper)o(ations)f(at)h(this)h(le)o(vel.)42
2915 y Fd(5.1)99 b(Implementing)p Fa(O)p 929 2915 30
4 v 37 w(APPEND)23 b Fd(with)j(and)f(without)g(concurr)n(ent)j(access)
42 3171 y Ff(Implications)19 b(of)h(attrib)n(ute)g(caching)f(on)h(O)p
1312 3171 25 4 v 29 w(APPEND.)h(Notes)f(on)g(concurrent)e(O)p
2460 3171 V 30 w(APPEND)i(vs.)26 b(not.)42 3370 y(Concurrent)19
b(O)p 502 3370 V 29 w(APPEND)i(is)g(nondeterministic.)42
3707 y Fd(5.2)99 b(P)n(ermissions)25 b(and)g(permission)g(checking)42
3963 y Ff(Permissions)20 b(can)g(change)f(while)h(\002le)h(is)g(open,)e
(can)h(all)h(of)f(a)h(sudden)e(f)o(ail.)42 4300 y Fd(5.3)99
b(T)-7 b(runcate)42 4555 y Ff(Our)20 b(truncate)f(al)o(w)o(ays)i
(resizes)g(when)e(possible)h(\(man)f(pages)h(indicate)g(that)g(it)h
(might)f(or)f(might)h(not)g(gro)n(w)f(\002les\).)42 4892
y Fd(5.4)99 b(Hard)25 b(links)42 5148 y Ff(No)c(such)e(thing.)1926
5610 y(9)p eop end
%%Page: 10 10
TeXDict begin 10 9 bop 42 169 a Fd(5.5)99 b(Symlinks)42
424 y Ff(What)21 b(to)f(say?)25 b(Can)c(ha)n(v)o(e)f(tar)o(gets)f(that)
h(don')o(t)f(e)o(xist.)42 804 y Fg(6)120 b(Misc.)42 1089
y Ff(Don')o(t)19 b(quite)h(kno)n(w)f(where)h(this)g(stuf)n(f)g(goes)g
(yet.)42 1426 y Fd(6.1)99 b(Adding)26 b(I/O)e(ser)o(v)o(ers)42
1682 y Ff(Is)d(there)f(an)o(ything)e(trick)o(y)h(here?)24
b(There)c(is)h(if)f(the)h(serv)o(ers)e(communicate.)42
2019 y Fd(6.2)99 b(Migrating)25 b(\002les)g(and)h(changing)f(distrib)n
(utions)42 2274 y Ff(Distrib)n(utions)e(don')o(t)f(change)g(for)h(a)h
(gi)n(v)o(en)f(meta\002le.)35 b(So)23 b(we)h(need)f(to)h(get)f(a)h(ne)n
(w)g(meta\002le)f(and)g(go)g(from)g(there.)34 b(This)24
b(is)h(also)42 2374 y(the)c(appropriate)c(w)o(ay)k(to)f(mo)o(v)o(e)f
(meta\002les)h(around)f(in)h(order)f(to)h(balance)f(the)i(metadata)e
(load)h(\(if)g(necessary\).)42 2711 y Fd(6.3)99 b(Meta\002le)26
b(stuf\002ng)42 2966 y Ff(This)g(is)g(our)f(v)o(ersion)f(of)h
(\223inode)g(stuf)n(\002ng\224,)g(the)h(technique)e(used)h(to)h(store)f
(small)h(\002les)g(in)g(the)g(inode)e(data)h(space)h(rather)e(than)42
3066 y(allocating)19 b(blocks)h(for)g(data)g(\(in)g(local)g(\002le)h
(systems)f(and)g(such\).)42 3265 y(In)i(our)g(v)o(ersion)f(for)h(small)
h(\002les)g(we)g(can)f(simply)g(store)h(the)f(data)h(in)f(the)h
(bytestream)e(space)h(associated)h(with)f(the)h(meta\002le.)31
b(In)42 3365 y(f)o(act,)20 b(one)g(type)g(of)g(\002le)h(system)f(that)g
(one)g(could)f(b)n(uild)h(with)g(PVFS2)h(w)o(ould)e(al)o(w)o(ays)i(to)f
(this.)42 3564 y(Ho)n(w)j(do)f(we)h(kno)n(w)f(when)g(to)h(use)g(this?)
33 b(Do)22 b(we)h(e)n(v)o(er)f(switch)h(from)f(doing)f(this)i(to)g(the)
g(tradational)e(data\002le)i(approach?)30 b(Ho)n(w)42
3664 y(do)20 b(we)h(do)e(that?)26 b(It)20 b(might)g(not)f(be)i(so)f
(hard)f(with)i(serv)o(er)e(communication,)e(b)n(ut)j(ho)n(w)g(do)g(we)g
(do)g(it)h(without?)42 4001 y Fd(6.4)99 b(Adding)26 b(metaser)o(v)o
(ers)42 4256 y Ff(At)f(the)f(moment)f(we)i(ha)n(v)o(e)f(said)g(that)h
(we)f(will)h(ha)n(v)o(e)f(a)h(static)g(metaserv)o(er)d(list.)39
b(Ho)n(w)24 b(might)f(we)i(approach)d(using)i(a)h(dynamic)42
4356 y(list?)1905 5610 y(10)p eop end
%%Trailer

userdict /end-hook known{end-hook}if
%%EOF
